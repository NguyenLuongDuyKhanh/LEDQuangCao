C51 COMPILER V9.60.0.0   MAIN                                                              12/26/2020 13:30:18 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: D:\Installation\Keil\C51\BIN\C51.EXE main.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Lis
                    -tings\main.lst) TABS(2) OBJECT(.\Objects\main.obj)

line level    source

   1          //#include<reg52.h>
   2          #include <REGX51.H>
   3          //#include <main.c>
   4          
   5          typedef enum Row {
   6              R1,
   7              R2,
   8              R3,
   9              R4,
  10              R5,
  11              R6,
  12              R7,
  13              R8,
  14              None,
  15          }Row;
  16          
  17          typedef enum Scanner_status {
  18              HC138,
  19              HC595,
  20              Stable
  21          }Scanner_status;
  22          
  23          #define SDI  P3_0 //Chan 14 data
  24          #define CLK  P3_1 //Chan 11 clock
  25          #define STR  P3_2 //Chan 12 chot
  26          
  27          
  28          
  29          unsigned char i;
  30          //unsigned char ma[10]={0x00,0x01,0x02,0x04,0x08,0x10,0x20,0x40,0x80,0x00}; //Mang LED
  31          unsigned char ma[10]={0x00,0x01,0x02,0x04,0x08,0x10,0x20,0x40,0x80,0x00}; //Mang LED
  32          
  33          
  34          
  35          Scanner_status GlobalScannerStatus;
  36          
  37          //char example[8]={0B01111111b, 01001001b, 01001001b, 01001001b  ,00110110b , 0b, 0b, 0b };
  38          
  39          unsigned char example1[8]={0x7F,0x49, 0x49, 0x49  ,0x36 , 0x0,0x0,0x0}; //B
  40          unsigned char example2[8]={0x1f  , 0x24  , 0x44  , 0x44  , 0x7f , 0x0,0x0,0x0 }; //A
  41          unsigned char example3[8]={0x7f  , 0x41  , 0x41  , 0x41  , 0x2e , 0x00,0x00,0x00 };//D
  42          //unsigned char example[8]={0x0f  , 0x0f  , 0x0f  , 0x0f  , 0x0f , 0x0f,0x0f,0x0f };
  43          //unsigned char example[8]={0xff  , 0xff  , 0xff  , 0xff  , 0xff , 0xff,0xff,0xff };
  44          void delay_ms(unsigned int);
  45          void RowScanner();
  46          void ColumnScanner();
  47          void truyen(unsigned char b1);
  48          void delay(unsigned char time);
  49          Row CurrentRow;
  50          
  51          void main (void)
  52          {
  53   1        CurrentRow = R1;
  54   1        P2 = 0x01;
C51 COMPILER V9.60.0.0   MAIN                                                              12/26/2020 13:30:18 PAGE 2   

  55   1        P3 = 0x00;
  56   1        //TMOD=0x01;    //Khoi tao timer 0 che do 16bit
  57   1        GlobalScannerStatus = Stable;
  58   1        while(1)
  59   1        {
  60   2          /*
  61   2          if(Stable == GlobalScannerStatus)
  62   2          {
  63   2            RowScanner();
  64   2            P2=CurrentRow;
  65   2          }
  66   2          */
  67   2          if(Stable == GlobalScannerStatus)
  68   2          {
  69   3            ColumnScanner();
  70   3          }
  71   2          //delay_ms(1);
  72   2          /*
  73   2              for(i=0;i<10;i++){      //Truyen 3 du lieu khac nhau vao 3 ic
  74   2              truyen(0xff,ma[i],ma[9-i]);    //Truyen du lieu vao 3 IC
  75   2              delay(5);
  76   2              truyen(0x00,ma[i-1],ma[9-i]);
  77   2              delay(5);
  78   2          }
  79   2          */
  80   2        }
  81   1      }
  82          
  83          void delay_ms(unsigned int t)
  84          {
  85   1          unsigned int i,j;
  86   1          for(i=0;i<t;i++)
  87   1          for(j=0;j<500;j++);
  88   1          //for(j=0;j<1275;j++);
  89   1      }
  90          
  91          void RowScanner()
  92          {
  93   1        GlobalScannerStatus = HC138;
  94   1        
  95   1        if(CurrentRow==R8)
  96   1          {
  97   2            CurrentRow=R1;
  98   2          }else CurrentRow++;
  99   1        GlobalScannerStatus = Stable;
 100   1      }
 101          void delay(unsigned char time){ //Chuong trinh tao tre 50ms
 102   1          unsigned char t;
 103   1          for(t=0;t<time;t++){
 104   2              TH0=0x3c;
 105   2              TL0=0xb0;
 106   2              TR0=1;
 107   2              while(!TF0);
 108   2              TF0=TR0=0;
 109   2          }
 110   1      }
 111          
 112          void ColumnScanner()
 113          {
 114   1        
 115   1        int column_number;
 116   1        int row_number;
C51 COMPILER V9.60.0.0   MAIN                                                              12/26/2020 13:30:18 PAGE 3   

 117   1        unsigned char temp;
 118   1        GlobalScannerStatus = HC595;
 119   1        for(row_number=0;row_number<8;row_number++)
 120   1        {
 121   2        for(column_number=7;column_number>=0;column_number--)
 122   2        {
 123   3          temp = example1[column_number]<<row_number;
 124   3          SDI=temp&0x80;
 125   3          CLK=0;
 126   3          CLK=1;
 127   3        }
 128   2        
 129   2          for(column_number=7;column_number>=0;column_number--)
 130   2        {
 131   3          temp = example2[column_number]<<row_number;
 132   3          SDI=temp&0x80;
 133   3          CLK=0;
 134   3          CLK=1;
 135   3        }
 136   2        
 137   2          for(column_number=7;column_number>=0;column_number--)
 138   2        {
 139   3          temp = example3[column_number]<<row_number;
 140   3          SDI=temp&0x80;
 141   3          CLK=0;
 142   3          CLK=1;
 143   3        }
 144   2        
 145   2          for(column_number=7;column_number>=0;column_number--)
 146   2        {
 147   3          temp = example1[column_number]<<row_number;
 148   3          SDI=temp&0x80;
 149   3          CLK=0;
 150   3          CLK=1;
 151   3        }
 152   2        STR=0; STR=1; //Chot hien thi du lieu
 153   2        P2=row_number;
 154   2        }
 155   1        GlobalScannerStatus = Stable;
 156   1      }
 157          
 158          void truyen(unsigned char b1){
 159   1      /*Chuong trinh truyen du lieu vao 3 IC 74HC595
 160   1      Cac ban co the mo rong them bao nhieu IC tuy thich
 161   1      bang cach them code theo mau cua chuong trinh goc
 162   1      */
 163   1          unsigned char i,Q;
 164   1          //Q=b3; for(i=0;i<8;i++){SDI=Q&0x80;CLK=0;CLK=1;Q<<=1;} //ic 3
 165   1          //Q=b2; for(i=0;i<8;i++){SDI=Q&0x80;CLK=0;CLK=1;Q<<=1;} //ic 2
 166   1          //Q=b1; 
 167   1          Q=b1;
 168   1          for(i=0;i<8;i++)
 169   1          {
 170   2            SDI=Q&0x80;
 171   2            CLK=0;
 172   2            CLK=1;
 173   2            Q<<=1;
 174   2          } //ic 1
 175   1          delay(5);
 176   1          STR=0; 
 177   1          STR=1; //Chot hien thi du lieu
 178   1      }
C51 COMPILER V9.60.0.0   MAIN                                                              12/26/2020 13:30:18 PAGE 4   



MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    332    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     37       2
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
